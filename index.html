<!DOCTYPE html>
<html>
	<head>
		<link rel = "stylesheet" type = "text/css" href = "/css/main.css" >
		<script src="processing.js"></script>
		<script type="application/processing" data-processing-target="pjs">
		/* @pjs globalKeyEvents="true"; */ 
		void setup() {
		  size(400, 400);
		}
		//Submitted by Christopher Werry
//Created in 3 days for Ludum Dare 42
//Theme: Running out of space
//Use arrow keys

var screen = "menu";
var state = "grow";
var goalX = 0;
var goalY = 0;
var goalR = 10;
var goalColor = color(255, 221, 0);
var goalTextSize = 0;
var growthBallColor = color(0, 255, 21);
var growthBallX = 0;
var growthBallY = 0;
var growthBallR = 10;
var drawGrowthBall = false;
var backgroundColor = color(71, 217, 210);
var holder = [];
var ballStrokeWeight = 2;
var radius = 10;
var ballX = 20;
var ballY = 400-radius-ballStrokeWeight/2;
var keys = [];
var jumpKey = false;
var jumpTimer = 0;
var jumpStrength = -200;
var jumpForceMax = -20;
var ballForceX = 0;
var jumpForceY = 0;
var ballVelX = 0;
var ballVelY = 0;
var ballAccX = 0;
var ballAccY = 0;
var gravityForce = 1;
var ballSize = 1;
var start = false;
var time = 0;
var growthRate = 2;
var radiusI = radius;
var horizontalSpeed = 2;
var Platform = function(x1,y1,x2,y2){
    this.x1 = x1;
    this.y1 = y1;
    this.x2 = x2;
    this.y2 = y2;
    this.color = color(0, 0, 0);
};
var tolerance = 5;
var ground = 399;
var groundColor = color(0, 0, 0);
var kill = false;
var onGround = true;
var ballColor = color(255, 0, 0);
var ballXI = ballX;
var ballYI = ballY;

Platform.prototype.draw = function() {
     stroke(this.color);
     line(this.x1,this.y1,this.x2,this.y2);
     stroke(0,0,0);
};
var updateHolder = function(){
    holder[0] = ("jumpKey: " + jumpKey);
    holder[1] = ("jumpTimer: " + jumpTimer);
    holder[2] = ("ballForceX: " + ballForceX);
    holder[3] = ("jumpForceY: " + jumpForceY);
    holder[4] = ("ballVelX: " + ballVelX);
    holder[5] = ("ballVelY: " + ballVelY);
    holder[6] = ("ballAccX: " + ballAccX);
    holder[7] = ("ballAccY: " + ballAccY);
    holder[8] = ("ballSize: " + ballSize);
    holder[9] = ("radius: " + radius);
    holder[10] = ("ballX: " + ballX);
    holder[11] = ("kill: " + kill);

};

var applyForce = function(ballForceY){
    ballAccY += ballForceY;
};

var updateBall = function(){
    ballVelX += ballAccX;
    ballVelY += ballAccY;
    ballX += ballVelX;
    ballY += ballVelY;
    ballAccX = 0;
    ballAccY = 0;
};

Platform.prototype.checkEdges = function(){
    //Platform collision when center of ball is underneath or above platform
    if(ballX> this.x1 && ballX< this.x2){
        //Ball is below platform
        if(ballY > this.y1){
        this.color = color(242, 255, 0);
        }
        //Ball is above platform
        if(ballY < this.y1){
            this.color = color(255, 0, 255);
        }
        //Ball collided below platform
        if(ballVelY < 0 && ballY - radius - ballStrokeWeight/2 < this.y1 && ballY - radius - ballStrokeWeight/2 > this.y1 - tolerance){
            this.color = color(0, 255, 4);
            ballVelY = 0;
            ballY = this.y1 + radius + ballStrokeWeight/2;
        }
        //Ball is squished between ground and platform
        if(start && ballY - radius - ballStrokeWeight/2 < this.y1 && ballY - radius - ballStrokeWeight/2 > this.y1 - tolerance && onGround){
            kill = true;
        }
        //Ball collided above platform
        if(ballVelY > 0 && ballY + radius + ballStrokeWeight/2 > this.y1 && ballY + radius + ballStrokeWeight/2 < this.y1 + tolerance){
            this.color = color(0, 17, 255);
            ballVelY = 0;
            ballY = this.y1 - radius - ballStrokeWeight/2;
            onGround = true;
        }
    }
    //Ball not above or below platform
    else{
        this.color = color(0, 0, 0);
    }
    //Kill effects
    if(kill === true){
        start = false;
        //Add ball squishing effects
        ballColor = color(255, 255, 255);
    }
    //Ball colliding with left edge of platform
    if(ballX < this.x1 && ballX + radius > this.x1){
        this.color = color(0, 255, 4);
        if(sq(this.x1-ballX) + sq(this.y1-ballY) < sq(radius)){
            if(onGround){
                kill = true;
            }
            
        }
    }
};

var checkEdges = function(){
    //Ball is on ground
    if(ballY > ground - radius - ballStrokeWeight/2){
        ballY = ground - radius - ballStrokeWeight/2;
        ballVelY = 0;
        groundColor = color(255, 0, 255);
        onGround = true;
    }
    //Ball is above ground
    else{
        groundColor = color(0, 0, 0);
        onGround = false;
    }
};

void keyPressed(){
    if(!start){
        start = true;
        time = 0;
    }
    if(kill){
        ballX = ballXI;
        ballY = ballYI;
        radius = radiusI;
        kill = false;
    }
    if(keyCode === UP){
        jumpKey = true;
        jumpForceY = 0;
    }
    if(keyCode === LEFT){
        ballVelX = -horizontalSpeed;
    }
    if(keyCode === RIGHT){
        ballVelX = horizontalSpeed;
    }
    keys[keyCode] = true;
}

void keyReleased(){
    if(keyCode === UP){
        jumpKey = false;
        //Apply an initial force to the ball
        jumpForceY += jumpStrength*jumpTimer;
        if(jumpForceY < jumpForceMax){
            jumpForceY = jumpForceMax;
        }
        applyForce(jumpForceY);
    }
    if(keyCode === LEFT ){
        ballVelX = 0;
    }
    if(keyCode === RIGHT){
        ballVelX = 0;
    }
    keys[keyCode] = false;
}
var Platforms = [];
var level = 1;
var changeLevel = function(){
    time = 0;
    /**LEVEL 1**/
    if(level === 1){
    state = "grow";
    ballColor = color(16, 199, 28);
    radius = 10;
    radiusI = 10;
    ballX = 20;
    ballY = 400-radius-ballStrokeWeight/2;
    goalR = 30;
    goalX = 300;
    goalY = 302-goalR-2;
    goalTextSize = goalR+10;
    
    }
    
    /**LEVEL 2**/
    if(level === 2){
    state = "shrink";
    goalR = 11;
    goalX = 383;
    goalY = 386;
    radius = 140;
    radiusI = 140;
    ballX = 142;
    ballY = 400-radius - ballStrokeWeight/2;
    //Platforms.push(new Platform(361,370,400,370));
    //Platforms.push(new Platform(200,150,300,150));
    }
    
    if(level === 3){
        drawGrowthBall = true;
        growthBallX = 280;
        growthBallY = 247;
        growthBallR = 20;
        state = "shrink";
        goalR = 11;
        goalX = 375;
        goalY = 386;
        radius = 100;
        radiusI = 100;
        ballX = 102;
        ballY = 400-radius - ballStrokeWeight/2;
        //Platforms.push(new Platform(123,350,200,350));
        //Platforms.push(new Platform(200,150,300,150));
    }
    if(level === 4){
        screen = "win";
        
    }
};

changeLevel(level);
draw = function() {
    
    //Draw the background
    background(backgroundColor);
    //Draw the level hint
    if(level === 1 ){
        textSize(200);
        text("→",100,200);
        textSize(12);
    }
    if(level === 2 ){
        textSize(200);
        text("→",100,100);
        textSize(12);
    }
    if(level === 3){
        if(drawGrowthBall){
            textSize(200);
            text("↑",150,200);
            textSize(12);
        }
        if(!drawGrowthBall){
            textSize(200);
            text("→",100,100);
            textSize(12);
        }
    }
    //Draw the ground
    stroke(groundColor);
    line(-10,ground,410,ground);
    stroke(0, 0, 0);
    //Draw the growth ball
    if(drawGrowthBall){
        fill(growthBallColor);
        stroke(255, 255, 255);
        ellipse(growthBallX,growthBallY,growthBallR*2,growthBallR*2);
        stroke(0, 0, 0);
        if(dist(ballX,ballY,growthBallX,growthBallY) < radius + growthBallR){
            drawGrowthBall = false;
            state = "grow";
            radiusI = radius;
            time = 0;
            ballColor = growthBallColor;
        }
    }
    //Draw the goal
    fill(goalColor);
    ellipse(goalX,goalY,goalR*2,goalR*2);
    line(goalX-goalR/3,goalY-goalR/3,goalX-goalR/3,goalY);
    line(goalX+goalR/3,goalY-goalR/3,goalX+goalR/3,goalY);
    
    arc(goalX,goalY,goalR,goalR,radians(50),radians(130));
    if(dist(ballX,ballY,goalX,goalY) < radius + goalR){
        level++;
        changeLevel();
    }
    //Start the timer
    if(start === true && keyPressed){
        if(state === "grow"){
            ballColor = growthBallColor;
            growthRate = 4;
            time+= 1/60;
        }
        if(state === "shrink"){
            ballColor = color(255, 0, 0);
            growthRate = 0.5;
            time-=1/60;
        }
    }
    //Draw the platform
    tolerance = 5 + abs(ballVelY);
    for ( var i = 0; i < Platforms.length; i++){
        Platforms[i].checkEdges();
        Platforms[i].draw();
    }

    //Apply mathematics to the ball
    applyForce(gravityForce);
    radius = (1+time*growthRate)*radiusI;
    //Ball is squished between ground and platform
    
    updateBall();
    checkEdges();
    //Draw the ball
    fill(ballColor);
    strokeWeight(2);
    ellipse(ballX,ballY,radius*2,radius*2);
    
    //Start the jump
    if(jumpKey){
        jumpTimer += 1/60;    
    }
    else{
        jumpTimer = 0;
    }
    //Check for kill
    if(radius <= 0){
        changeLevel();
    }
    if(screen === "win"){
        fill(0, 0, 0);
        textSize(80);
        text("YOU WIN!",8,100); 
        text("	↺",150,194);
        if(mouseIsPressed || keyCode === 10){
            screen = "game";
            level = 1;
            changeLevel();
            
        }
        
    }
    /*
    //Debug
    updateHolder();
    fill(0, 0, 0);
    for(var i = 0; i < holder.length ; i++){
        text(holder[i],0,10+10*i);
    }
    text("time: " + time,340,10);
    text("x: " + mouseX,340,20);
    text("y: " + mouseY,340,30);
    */
    
};

		</script>
		<title>kalcoslinder portfolio</title>
	</head>
	<body>
		<canvas id="pjs"> </canvas>
		
		
		<footer>
    		<ul>
        		<li><a href="mailto:christopherwerry@gmail.com">email</a></li>
			<li><a href="https://www.khanacademy.org/profile/crustyoucantrust/projects">khanacademy</a></li>
        		<li><a href="https://github.com/kalcoslinder/kalcoslinder.github.io">github</a></li>
			</ul>
		</footer>
	</body>
</html>
